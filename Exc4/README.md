# Exc4
На данном этапе развития приложения предлагаю использовать REST для интеграции core-app и osago-aggregator. Плюсы данного подхода:
- сразу понимаем, что сервис-агрегатор недоступен или долго отвечает;
- сразу отвечаем клиенту, что не можем обработать заявку:
    - одно из бизнес-требований -- показывать предложение, как только его получили от страховой компании;
    - можно сделать предположение, что ответ о невозможности выполнить расчет тоже в приоритете, т.к. это улучшает пользовательский опыт;
- не храним и не обрабатываем в топике или очереди данные заявок, если сервис агрегатор недоступен;
- не плодим технологии, переиспользуем существующие Kafka и REST;
- нагрузку можно грубо оценить сверху как 5000 RPS (2500 одновременных пользователей делают по два запроса: создать заявку, отправить её на исполнение), чтобы с справиться с нагрузкой можем увеличивать количество экземпляров сервисов core-app и osago-aggregator.

При росте нагрузки, если предложенное решение будет не справляться, то запрос на получение предложений по ОСАГО можно будет отправлять через отдельный топик Kafka. С дополнительным health check для быстрого ответа клиенту, что сервис недоступен. 

Для отправки предложений по ОСАГО предлагаю использовать SSE, она позволит сразу показывать новое предложение клиенту, как того требует бизнес. При этом эта технология проще WebSocket и менее ресурсоемкая, чем разные виды polling-а. Хранить данные открытых соединений можно в Redis - быстро и достаточно надежное in-memory хранилище, подходящее для этого задачи.

Предлагаемые паттерны надёжности:
- сервис **osago-aggregator** при запросах к серисам поставщиков:
    - **retry** для посторных запросов к API поставщиков;
    - **rate limiter** в случае, если API постащика имеет ограничение по количеству запросов в еденицу времени;
- приложение **InsureTech Web** или **gateway** при запросах к **core-app**:
    - **timeout** для принудительного закрытия "зависших" соединений;
- сервис **core-app** при запросах к сервису **osago-aggregator**:
    - **curcit breaker** для предотвращения каскадного распространения ошибок при недоступности сервиса **osago-aggregator** и для быстрого ответа клиенту;
    - **timeout** для принудительного закрытия "зависших" соединений.