# Exc3 
Риски и проблемы существующего решения:
1. Синхронное получение данных по продуктам и тарифам из **внешних** систем. Потребители **core-app** и **ins-comp-settelment** вынуждены ждать и держать соединение открытым пока **ins-product-aggregator** опросит все внешние системы и получит данные из них. Т.е. ресурсы потребителей и сети тратятся нерационально.
2. Даже если сервис **ins-comp-settelment** выполняет запросы к внешним системам параллельно, таймаут HTTP-запроса к сервису **ins-comp-settelment** будет скорее всего меньше, чем потенциальное время ответа самого медленного внешнего источника. Т.о. потребители могут закрыть соединение по таймауту и не получить никаких данных.
3. В случае ошибки или недоступности источника, потребители не получат данные и ошибка может распространиться по всему приложению из-за сильной связанности его компонент.
4. Из-за сильной связанности данную схему сложно масштабировать: как по количеству внешних источников, так и по количеству запросов к **ins-comp-settelment**.
5. Использование short или long polling решает только проблему долгого ответа источника, но не решает проблемы неэффективного использования ресурсов и каскадных ошибок.
6. Отсутствие у **ins-comp-settelment** БД не позволяет использовать паттерн retry для повторного получения данных.

Чтобы снизить связанность сервисов, предлагается добавить публикацию событий об изменении продуктов и тарифов. Публиковать события будет сервис **ins-comp-settelment**, потребителями будут сервисы **core-app** и **ins-comp-settelment**. Таким образом, реализуется интеграционный паттерн Pub-Sub.

Сервис **ins-comp-settelment** будет опрашивать внешние системы для получения данных о продуктах и тарифах. Каждое изменение сервис будет сохранять в свою БД: новый тариф/продукт, изменение или удаление. В качестве брокера сообщений будет выступать Kafka, из высокой производительности, надежности и нативной реализации паттерна Pub-Sub. Для публикации предлагается использовать CDC и паттерн Transaction Log на базе Debezium, чтобы не нагружать БД сервиса дополнительной нагрузкой, а сам сервис дополнительной логикой. 

Плюс решение Kafka + Debezium хорошо масштабируются, что важно при росте клиентской базы, который ожидает бизнес. Так же оно может быть переиспользовано в задании Exc4, где нагрузка ожидается еще больше.